<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="{{ url_for('static', filename='bid.png') }}" type="image/png">
    <title>å®¢æˆ·ç™»è®°ä¿¡æ¯ - {{ project.name }}{% if sub_project %} / {{ sub_project.segment_name }}{% endif %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: url("/static/img/bg_admin.jpg") no-repeat center center fixed;
            background-size: cover;
            font-family: "Microsoft YaHei", sans-serif;
        }

        .container-box {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            margin: 5vh auto;
            border-radius: 14px;
            max-width: 1000px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }

        @keyframes flash-once {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 1; }
        }

        .flash-once {
            animation: flash-once 1s ease-in-out;
        }
    </style>
</head>
<body>

<div class="container-box">

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show flash-message flash-once" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h4 class="mb-1">ğŸ“ é¡¹ç›®ç¼–å·ï¼š{{ project.code }} | {{ project.name }}</h4>
            {% if sub_project %}
            <h5 class="mb-2">ğŸ“„ æ‰€å±æ ‡æ®µï¼š{{ sub_project.segment_name }} | æ‹›æ ‡å†…å®¹ï¼š{{ sub_project.description or 'ï¼ˆæœªå¡«å†™ï¼‰' }}</h5>
            <p class="text-muted mb-2">â³ æˆªæ­¢æ—¶é—´ï¼š{{ sub_project.deadline.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</p>
            {% else %}
            <p class="text-muted mb-2">â³ æˆªæ­¢æ—¶é—´ï¼š{{ project.deadline.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</p>
            {% endif %}
            <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary btn-sm">â† è¿”å›æ§åˆ¶é¢æ¿</a>
        </div>

        <div class="ms-3" style="width: 300px;">
            <input type="text" id="searchSupplierInput" class="form-control" placeholder="ğŸ” æœç´¢æŠ•æ ‡å•ä½">
        </div>
    </div>

    {% if grouped_bids %}
    {% for group in grouped_bids %}
        <div class="mb-4">
            <h5 class="text-primary">ğŸ“„ æ ‡æ®µï¼š{{ group.subproject.segment_name }}</h5>
            <p class="text-muted">â³ æˆªæ­¢æ—¶é—´ï¼š{{ group.subproject.deadline.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</p>

            {% if group.bids %}
            <div class="accordion mb-3" id="bidsAccordion_{{ group.subproject.id }}">
                {% for bid in group.bids %}
                <div class="accordion-item customer-card" data-name="{{ bid.supplier_name }}">
                    <h2 class="accordion-header" id="heading{{ bid.id }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapse{{ bid.id }}" aria-expanded="false"
                                aria-controls="collapse{{ bid.id }}">
                            æŠ•æ ‡å•ä½ï¼š{{ bid.supplier_name }}ï¼ˆ{{ "å·²ç¼´è´¹ âœ…" if bid.is_paid else "æœªç¼´è´¹ âŒ" }} )
                        </button>
                    </h2>
                    <div id="collapse{{ bid.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ bid.id }}"
                         data-bs-parent="#bidsAccordion_{{ group.subproject.id }}">
                        <div class="accordion-body">
                            <p><strong>å•ä½åç§°ï¼š</strong> {{ bid.supplier_name }}</p>
                            <p><strong>ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š</strong> {{ bid.credit_code }}</p>
                            <p><strong>è”ç³»äººï¼š</strong> {{ bid.agent }}</p>
                            <p><strong>è”ç³»ç”µè¯ï¼š</strong> {{ bid.phone }}</p>
                            <p><strong>é‚®ç®±ï¼š</strong> {{ bid.email }}</p>
                            <p><strong>æŠ¥åæ—¶é—´ï¼š</strong> {{ bid.file_time or 'â€”' }}</p>

                            <div class="mt-3 d-flex gap-2">
                                {% if not bid.is_paid %}
                                <a href="{{ url_for('edit_bid', bid_id=bid.id) }}" class="btn btn-sm btn-outline-primary">âœ ä¿®æ”¹</a>
                                {% endif %}
                                <form method="POST" action="{{ url_for('delete_bid', bid_id=bid.id) }}" onsubmit="return confirm('ç¡®è®¤åˆ é™¤è¿™æ¡æŠ•æ ‡è®°å½•ï¼Ÿ');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">ğŸ—‘ åˆ é™¤</button>
                                </form>
                                {% if bid.is_paid %}
                                <form method="POST" action="{{ url_for('resend_email', bid_id=bid.id) }}">
                                    <button type="submit" class="btn btn-sm btn-outline-success">ğŸ“§ é‡æ–°å‘é€é‚®ä»¶</button>
                                </form>
                                {% endif %}
                            </div>

                            {% if not bid.is_paid %}
                            <form method="POST" action="{{ url_for('mark_paid', bid_id=bid.id) }}">
                                <div class="d-grid gap-2 col-8 mx-auto mt-4">
                                    <button type="submit" class="btn btn-primary">å»ç¡®è®¤ç¼´è´¹æƒ…å†µ</button>
                                </div>
                            </form>
                            {% else %}
                            <div class="alert alert-success mt-3">é‚®ä»¶å·²å‘é€ï¼Œå®¢æˆ·å·²ç¼´è´¹ âœ…</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
                <div class="alert alert-info">è¯¥æ ‡æ®µæš‚æ— å®¢æˆ·ç™»è®°ä¿¡æ¯ã€‚</div>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <div class="alert alert-warning">è¯¥é¡¹ç›®æš‚æ— ä»»ä½•æ ‡æ®µæˆ–ç™»è®°ä¿¡æ¯ã€‚</div>
{% endif %}


</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  window.addEventListener('DOMContentLoaded', function () {
    setTimeout(function () {
      const flashMessages = document.querySelectorAll('.flash-message');
      flashMessages.forEach(function (msg) {
        let alert = bootstrap.Alert.getOrCreateInstance(msg);
        alert.close();
      });
    }, 5000);

    const searchInput = document.getElementById('searchSupplierInput');
    const customerCards = document.querySelectorAll('.customer-card');

    searchInput.addEventListener('input', function () {
        const keyword = this.value.trim().toLowerCase();

        customerCards.forEach(function (card) {
            const name = card.getAttribute('data-name').toLowerCase();
            if (name.includes(keyword)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });
  });
</script>

</body>
</html>



<!--<!DOCTYPE html>-->
<!--<html lang="zh-CN">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <link rel="icon" href="{{ url_for('static', filename='bid.png') }}" type="image/png">-->
<!--    <title>å®¢æˆ·ç™»è®°ä¿¡æ¯ - {{ project.name }}</title>-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
<!--    &lt;!&ndash; Bootstrap 5 &ndash;&gt;-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <style>-->
<!--        body {-->
<!--            background: url("/static/img/bg_admin.jpg") no-repeat center center fixed;-->
<!--            background-size: cover;-->
<!--            font-family: "Microsoft YaHei", sans-serif;-->
<!--        }-->

<!--        .container-box {-->
<!--            background-color: rgba(255, 255, 255, 0.95);-->
<!--            padding: 30px;-->
<!--            margin: 5vh auto;-->
<!--            border-radius: 14px;-->
<!--            max-width: 1000px;-->
<!--            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);-->
<!--        }-->

<!--        @keyframes flash-once {-->
<!--            0% { opacity: 0; }-->
<!--            50% { opacity: 1; }-->
<!--            100% { opacity: 1; }-->
<!--        }-->

<!--        .flash-once {-->
<!--            animation: flash-once 1s ease-in-out;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<div class="container-box">-->

<!--    {% with messages = get_flashed_messages(with_categories=true) %}-->
<!--    {% if messages %}-->
<!--    {% for category, message in messages %}-->
<!--    <div class="alert alert-{{ category }} alert-dismissible fade show flash-message flash-once" role="alert">-->
<!--        {{ message }}-->
<!--        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>-->
<!--    </div>-->
<!--    {% endfor %}-->
<!--    {% endif %}-->
<!--    {% endwith %}-->

<!--    <div class="d-flex justify-content-between align-items-center mb-4">-->
<!--        <div>-->
<!--            <h3>ğŸ“„ å®¢æˆ·ç™»è®°ä¿¡æ¯ - {{ project.code }}</h3>-->
<!--            <p>é¡¹ç›®åç§°ï¼š{{ project.name }}</p>-->
<!--            <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary btn-sm">â† è¿”å›æ§åˆ¶é¢æ¿</a>-->
<!--        </div>-->

<!--        <div class="ms-3" style="width: 300px;">-->
<!--            <input type="text" id="searchSupplierInput" class="form-control" placeholder="ğŸ” æœç´¢æŠ•æ ‡å•ä½">-->
<!--        </div>-->
<!--    </div>-->

<!--    {% if bids %}-->
<!--    <div id="customerListContainer">-->
<!--        <div class="accordion" id="bidsAccordion">-->
<!--            {% for bid in bids %}-->
<!--            <div class="accordion-item customer-card" data-name="{{ bid.supplier_name }}">-->
<!--                <h2 class="accordion-header" id="heading{{ bid.id }}">-->
<!--                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"-->
<!--                            data-bs-target="#collapse{{ bid.id }}" aria-expanded="false"-->
<!--                            aria-controls="collapse{{ bid.id }}">-->
<!--                        æŠ•æ ‡å•ä½ï¼š{{ bid.supplier_name }}ï¼ˆ{{ "å·²ç¼´è´¹ âœ…" if bid.is_paid else "æœªç¼´è´¹ âŒ" }})-->
<!--                    </button>-->
<!--                </h2>-->
<!--                <div id="collapse{{ bid.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ bid.id }}"-->
<!--                     data-bs-parent="#bidsAccordion">-->
<!--                    <div class="accordion-body">-->
<!--                        <p><strong>ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š</strong> {{ bid.credit_code }}</p>-->
<!--                        <p><strong>åœ°å€ï¼š</strong> {{ bid.supplier_address }}</p>-->
<!--                        <p><strong>æ³•å®šä»£è¡¨äººï¼š</strong> {{ bid.legal_person }}</p>-->
<!--                        <p><strong>å§”æ‰˜ä»£ç†äººï¼š</strong> {{ bid.agent }}</p>-->
<!--                        <p><strong>æ‰‹æœºï¼š</strong> {{ bid.phone }}</p>-->
<!--                        <p><strong>é‚®ç®±ï¼š</strong> {{ bid.email }}</p>-->
<!--                        <p><strong>è·å–æ–‡ä»¶æ–¹å¼ï¼š</strong> {{ bid.file_method }}</p>-->
<!--                        <p><strong>è·å–æ–‡ä»¶æ—¶é—´ï¼š</strong> {{ bid.file_time }}</p>-->

<!--                        <div class="mt-3 d-flex gap-2">-->
<!--                            {% if not bid.is_paid %}-->
<!--                            <a href="{{ url_for('edit_bid', bid_id=bid.id) }}" class="btn btn-sm btn-outline-primary">âœ ä¿®æ”¹</a>-->
<!--                            {% endif %}-->
<!--                            <form method="POST" action="{{ url_for('delete_bid', bid_id=bid.id) }}" onsubmit="return confirm('ç¡®è®¤åˆ é™¤è¿™æ¡æŠ•æ ‡è®°å½•ï¼Ÿ');">-->
<!--                                <button type="submit" class="btn btn-sm btn-outline-danger">ğŸ—‘ åˆ é™¤</button>-->
<!--                            </form>-->

<!--                            {% if bid.is_paid %}-->
<!--                            <form method="POST" action="{{ url_for('resend_email', bid_id=bid.id) }}">-->
<!--                                <button type="submit" class="btn btn-sm btn-outline-success">ğŸ“§ é‡æ–°å‘é€é‚®ä»¶</button>-->
<!--                            </form>-->
<!--                            {% endif %}-->
<!--                        </div>-->

<!--                        {% if not bid.is_paid %}-->
<!--                        <form method="POST" action="{{ url_for('mark_paid', bid_id=bid.id) }}">-->
<!--                            <div class="d-grid gap-2 col-8 mx-auto mt-4">-->
<!--                                <button type="submit" class="btn btn-primary">å»ç¡®è®¤ç¼´è´¹æƒ…å†µ</button>-->
<!--                            </div>-->
<!--                        </form>-->
<!--                        {% else %}-->
<!--                        <div class="alert alert-success mt-3">é‚®ä»¶å·²å‘é€ï¼Œå®¢æˆ·å·²ç¼´è´¹ âœ…</div>-->
<!--                        {% endif %}-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            {% endfor %}-->
<!--        </div>-->
<!--    </div>-->
<!--    {% else %}-->
<!--    <div class="alert alert-info">å½“å‰é¡¹ç›®æš‚æ— å®¢æˆ·ç™»è®°ä¿¡æ¯ã€‚</div>-->
<!--    {% endif %}-->

<!--</div>-->

<!--&lt;!&ndash; Bootstrap JS &ndash;&gt;-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>-->

<!--<script>-->
<!--  window.addEventListener('DOMContentLoaded', function () {-->
<!--    setTimeout(function () {-->
<!--      const flashMessages = document.querySelectorAll('.flash-message');-->
<!--      flashMessages.forEach(function (msg) {-->
<!--        let alert = bootstrap.Alert.getOrCreateInstance(msg);-->
<!--        alert.close();-->
<!--      });-->
<!--    }, 5000);-->

<!--    const searchInput = document.getElementById('searchSupplierInput');-->
<!--    const customerCards = document.querySelectorAll('.customer-card');-->

<!--    searchInput.addEventListener('input', function () {-->
<!--        const keyword = this.value.trim().toLowerCase();-->

<!--        customerCards.forEach(function (card) {-->
<!--            const name = card.getAttribute('data-name').toLowerCase();-->
<!--            if (name.includes(keyword)) {-->
<!--                card.style.display = '';-->
<!--            } else {-->
<!--                card.style.display = 'none';-->
<!--            }-->
<!--        });-->
<!--    });-->
<!--  });-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
